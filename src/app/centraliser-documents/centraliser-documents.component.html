<!-- src/app/centraliser-documents/centraliser-documents.component.html -->

<div class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 font-sans">
  <!-- Container principal avec styles modernes -->
  <div class="w-full max-w-5xl bg-white rounded-xl shadow-2xl p-8 space-y-8">

    <!-- Logo centr√© -->
    <div class="flex justify-center mb-6">
      <img
        src="assets/image-dawamaghreb/dawamaghreb_logo.jpg"
        alt="Logo Dawamaghreb"
        class="h-20"
      />
    </div>

    <!-- Titre principal -->
    <h2 class="text-4xl font-extrabold text-center text-blue-800 mb-8">Centraliser les documents</h2>

    <!-- Contenu en colonnes (pour les documents fournisseurs et MO) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Colonne Fournisseurs -->
      <section class="bg-blue-50 p-6 rounded-lg shadow-inner" aria-labelledby="fournisseurTitle">
        <h3 id="fournisseurTitle" class="text-2xl font-bold text-blue-700 mb-4 flex items-center">
          <span class="mr-2">üì¶</span> Documents destin√©s aux fournisseurs
        </h3>

        <div class="field-group mb-4">
          <label for="fileFournisseur" class="block text-sm font-medium text-gray-700 mb-2">
            S√©lectionner un fichier pour les fournisseurs:
          </label>
          <input
            #fileFournisseurInput
            type="file"
            id="fileFournisseur"
            accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.jpg,.png"
            (change)="onFileChange($event, 'fournisseur')"
            class="block w-full text-sm text-gray-500
                   file:mr-4 file:py-2 file:px-4
                   file:rounded-full file:border-0
                   file:text-sm file:font-semibold
                   file:bg-blue-100 file:text-blue-700
                   hover:file:bg-blue-200 transition duration-150 ease-in-out"
          />
        </div>

        <h4 class="text-lg font-semibold text-gray-800 mt-6 mb-3">Fichiers s√©lectionn√©s (non persist√©s sans backend) :</h4>
        <ul class="list-disc list-inside text-gray-700 space-y-1">
          <li *ngIf="fichiersFournisseurs.length === 0" class="text-gray-500 italic">Aucun fichier s√©lectionn√©.</li>
          <li *ngFor="let fichier of fichiersFournisseurs">
            <a
              [href]="fichier.url"
              [attr.download]="fichier.nom"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-600 hover:underline"
            >
              {{ fichier.nom }}
            </a>
          </li>
        </ul>
      </section>

      <!-- Colonne Ma√Ætre d‚Äôouvrage -->
      <section class="bg-green-50 p-6 rounded-lg shadow-inner" aria-labelledby="maitreOuvrageTitle">
        <h3 id="maitreOuvrageTitle" class="text-2xl font-bold text-green-700 mb-4 flex items-center">
          <span class="mr-2">üè¢</span> Documents destin√©s au ma√Ætre d‚Äôouvrage
        </h3>

        <div class="field-group mb-4">
          <label for="fileMaitreOuvrage" class="block text-sm font-medium text-gray-700 mb-2">
            S√©lectionner un fichier pour le ma√Ætre d‚Äôouvrage:
          </label>
          <input
            #fileMaitreOuvrageInput
            type="file"
            id="fileMaitreOuvrage"
            accept=".xlsx,.xls,.csv,.pdf,.doc,.docx,.jpg,.png"
            (change)="onFileChange($event, 'maitreOuvrage')"
            class="block w-full text-sm text-gray-500
                   file:mr-4 file:py-2 file:px-4
                   file:rounded-full file:border-0
                   file:text-sm file:font-semibold
                   file:bg-green-100 file:text-green-700
                   hover:file:bg-green-200 transition duration-150 ease-in-out"
          />
        </div>

        <h4 class="text-lg font-semibold text-gray-800 mt-6 mb-3">Fichiers s√©lectionn√©s (non persist√©s sans backend) :</h4>
        <ul class="list-disc list-inside text-gray-700 space-y-1">
          <li *ngIf="fichiersMaitreOuvrage.length === 0" class="text-gray-500 italic">Aucun fichier s√©lectionn√©.</li>
          <li *ngFor="let fichier of fichiersMaitreOuvrage">
            <a
              [href]="fichier.url"
              [attr.download]="fichier.nom"
              target="_blank"
              rel="noopener noreferrer"
              class="text-green-600 hover:underline"
            >
              {{ fichier.nom }}
            </a>
          </li>
        </ul>
      </section>
    </div>

    <!-- Section pour le tableau Excel (Devis), toujours en bas et centr√© -->
    <section class="bg-gray-50 p-6 rounded-lg shadow-inner mt-8" aria-labelledby="excelTableTitle">
      <h3 id="excelTableTitle" class="text-2xl font-bold text-gray-700 mb-4 flex items-center">
        <span class="mr-2">üìä</span> Tableau Excel du Devis (stock√© localement)
      </h3>

      <div *ngIf="!afficherTableau" class="text-gray-600 text-center py-4">
        Aucun devis Excel charg√©. Veuillez t√©l√©verser un fichier Excel pour le voir ici.
      </div>

      <div *ngIf="afficherTableau && tableauDevis.length > 0" class="overflow-x-auto bg-white shadow-lg rounded-lg p-4">
        <!-- Le tableau DataTables avec ID "monTableau" -->
        <table id="monTableau" class="min-w-full divide-y divide-gray-200 display responsive nowrap">
          <thead class="bg-gray-100">
            <tr>
              <!-- Correction ici : S√©paration de *ngFor et *ngIf avec <ng-container> -->
              <ng-container *ngFor="let header of tableauDevis[0]; let colIndex = index">
                <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    [attr.colspan]="getSpan(0, colIndex).colspan"
                    [attr.rowspan]="getSpan(0, colIndex).rowspan"
                    *ngIf="!isCellHidden(0, colIndex)">
                  {{ header }}
                </th>
              </ng-container>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let row of tableauDevis; let rowIndex = index">
              <!-- Sauter la premi√®re ligne (les en-t√™tes) car elle est dans le thead -->
              <ng-container *ngIf="rowIndex > 0">
                <!-- Correction ici : S√©paration de *ngFor et *ngIf avec <ng-container> -->
                <ng-container *ngFor="let cell of row; let colIndex = index">
                  <td
                      class="px-6 py-4 whitespace-nowrap"
                      [attr.colspan]="getSpan(rowIndex, colIndex).colspan"
                      [attr.rowspan]="getSpan(rowIndex, colIndex).rowspan"
                      contenteditable="true"
                      (blur)="updateCellFromEvent($event, rowIndex, colIndex)"
                      *ngIf="!isCellHidden(rowIndex, colIndex)">
                    {{ cell }}
                  </td>
                </ng-container>
              </ng-container>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Boutons d'action g√©n√©riques si besoin (pour l'instant, seulement des inputs de fichier) -->
    <!-- <div class="flex justify-center gap-4 mt-8">
      <button type="button" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300">
        Action G√©n√©rique
      </button>
    </div> -->

  </div>
</div>

<!-- Modal pour les messages (remplace alert()) -->
<div *ngIf="showModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl p-6 w-96">
    <h3 class="text-xl font-bold mb-4" [ngClass]="{'text-green-600': modalType === 'success', 'text-red-600': modalType === 'error', 'text-yellow-600': modalType === 'warning', 'text-blue-600': modalType === 'info'}">
      {{ modalTitle }}
    </h3>
    <p class="text-gray-700 mb-6">{{ modalMessage }}</p>
    <div class="flex justify-end">
      <button (click)="closeModal()"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        OK
      </button>
    </div>
  </div>
</div>



  




  
  