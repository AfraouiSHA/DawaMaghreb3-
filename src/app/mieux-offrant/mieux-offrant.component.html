<!-- Image de fond floutée -->
<div class="blur-background"></div>

<!-- Conteneur principal -->
<div class="ao-container">

<!-- Conteneur principal avec fond flou -->
<div class="page-container">
  <!-- Image de fond floutée qui couvre toute la page -->
  <div class="blur-background"></div>

  <!-- Contenu principal -->
  <div class="ao-container">
    <!-- Logo centré en haut -->
    <div class="logo-container">
      <img src="assets/image-dawamaghreb/dawamaghreb_logo.jpg" alt="Logo Dawa" class="logo" />
    </div>

    <!-- Le reste de votre contenu... -->
    <section class="ao-header card">
      <!-- ... -->
    </section>
    
    <!-- ... autres sections ... -->
  </div>
</div>

  <!-- Section 1 : En-tête de l'AO -->
  <section class="ao-header card">
    <div class="ao-meta">
      <h2>{{ao.reference}} - {{ao.objet}}</h2>
      <div class="meta-grid">
        <div>
          <label>Date clôture :</label>
          <span>{{ao.dateOuverture | date:'dd/MM/yyyy'}}</span>
        </div>
        <div>
          <label>Statut :</label>
          <span class="status-badge en-cours">En évaluation</span>
        </div>
        <div>
          <label>Responsable :</label>
          <span>Chef de projet</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 2 : Tableau comparatif -->
  <section class="comparison-section card">
    <div class="section-header">
      <h2>Comparaison des offres</h2>
      <div class="export-actions">
        <button class="export-btn">
          <i class="icon-download"></i> Exporter
        </button>
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="offers-table">
        <thead>
          <tr>
            <th class="col-company">Fournisseur</th>
            <th class="col-price">Montant (MAD)</th>
            <th class="col-score">Score</th>
            <th class="col-conformity">Conformité</th>
            <th class="col-actions">Documents</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let offre of offres" [class.highlighted]="offre.noteGlobale >= 85">
            <td class="company-cell">
              <img [src]="offre.fournisseur.logoUrl" class="company-logo">
              <div>
                <div class="company-name">{{offre.fournisseur.nom}}</div>
                <div class="company-id">RC: {{fournisseur.rc}}</div>
              </div>
            </td>
            <td class="price-cell">
              {{offre.montantTotal | number:'1.2-2'}}
              <div class="price-diff" [class.under-budget]="offre.montantTotal < 4800000">
                {{(offre.montantTotal - 4800000) / 4800000 | percent:'1.2-2'}}
              </div>
            </td>
            <td class="score-cell">
              <div class="score-value">{{offre.noteGlobale | number:'1.1-1'}}/100</div>
              <div class="score-bar">
                <div class="bar-fill" [style.width.%]="offre.noteGlobale"></div>
              </div>
            </td>
            <td class="conformity-cell">
              <span class="conformity-badge" [class.conforme]="offre.conformiteAdministrative.statut === 'Conforme'">
                {{offre.conformiteAdministrative.statut}}
              </span>
              <div *ngIf="offre.conformiteAdministrative.manquements.length > 0" class="non-conformites">
                {{offre.conformiteAdministrative.manquements.join(', ')}}
              </div>
            </td>
            <td class="actions-cell">
              <button class="doc-btn" (click)="openDocument('technique')">
                <i class="icon-file-text"></i> Technique
              </button>
              <button class="doc-btn" (click)="openDocument('financiere')">
                <i class="icon-file-text"></i> Financière
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Section 3 : Analyse technique -->
  <section class="analysis-section card">
    <div class="tabs">
      <button class="tab active">Analyse Technique</button>
      <button class="tab">Analyse Financière</button>
    </div>
    
    <div class="evaluation-details">
      <h3>Fiches d'évaluation technique</h3>
      <div class="commission-members">
        <div class="member" *ngFor="let member of commissionMembers">
          <div class="member-avatar">{{member.initials}}</div>
          <div class="member-name">{{member.name}}</div>
        </div>
      </div>
      
      <table class="criteria-table">
        <thead>
          <tr>
            <th>Critère</th>
            <th>Pondération</th>
            <th>Note</th>
            <th>Note pondérée</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let critere of technicalCriteria">
            <td>{{critere.nom}}</td>
            <td>{{critere.ponderation}}%</td>
            <td>{{critere.note}}/10</td>
            <td>{{(critere.note * critere.ponderation / 10) | number:'1.2-2'}}</td>
          </tr>
          <tr class="total-row">
            <td>Total</td>
            <td>100%</td>
            <td>{{calculateAverage(technicalCriteria)}}/10</td>
            <td>{{calculateWeightedAverage(technicalCriteria) | number:'1.2-2'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Section 4 : Analyse financière -->
  <section class="financial-section card">
    <h2>Analyse Financière</h2>
    
    <div class="financial-grid">
      <div class="financial-summary">
        <div class="summary-item">
          <label>Budget prévisionnel :</label>
          <span>4 800 000 MAD</span>
        </div>
        <div class="summary-item">
          <label>Meilleure offre :</label>
          <span>4 520 000 MAD</span>
        </div>
        <div class="summary-item">
          <label>Économie :</label>
          <span class="savings">280 000 MAD (5.83%)</span>
        </div>
      </div>
      
      <div class="financial-chart">
        <!-- Graphique des offres (à implémenter avec une librairie comme Chart.js) -->
        <div class="chart-placeholder">
          [Histogramme comparatif des offres]
        </div>
      </div>
    </div>
    
    <div class="price-ranking">
      <h3>Classement par prix</h3>
      <ol>
        <li *ngFor="let offre of offres">
          {{offre.fournisseur.nom}} - {{offre.montantTotal | number:'1.2-2'}} MAD
        </li>
      </ol>
    </div>
  </section>

  <!-- Section 5 : Décision -->
  <section class="decision-section card">
    <h2>Décision Finale</h2>
    
    <div class="recommendation-box">
      <div class="recommendation-header">
        <h3>Votre Décision Finale</h3>
        <div class="recommendation-status">À valider</div>
      </div>
      <p>{{recommandation.texte}}</p>
      
      <div class="decision-form">
        <label>Votre commentaire :</label>
        <textarea [(ngModel)]="commentairesChefProjet" placeholder="Ajoutez vos observations..."></textarea>
        
        <div class="decision-buttons">
          <button class="validate-btn" (click)="validateDecision()">
            <i class="icon-check"></i> Valider la décision
          </button>
          <button class="request-btn" (click)="requestModification()">
            <i class="icon-edit"></i> Demander modification
          </button>
          <button class="reject-btn" (click)="rejectDecision()">
            <i class="icon-x"></i> Rejeter
          </button>
        </div>
      </div>
    </div>
  </section>
</div>



