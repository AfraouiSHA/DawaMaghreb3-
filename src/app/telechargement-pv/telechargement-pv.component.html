<div class="background-blur"></div>

<div class="container">
  <header>
    <img src="assets/image-dawamaghreb/dawamaghreb_logo.jpg" alt="Logo Dawa" class="logo" />
    <h1>TÃ©lÃ©chargement du ProcÃ¨s-Verbal</h1>
  </header>

  <section class="infos">
    <h2>ğŸ§¾ Informations gÃ©nÃ©rales sur le PV</h2>
    <div *ngIf="pvInfo">
      <p><strong>Titre du PV :</strong> {{ pvInfo.pv_title || pvInfo.file_name }}</p>
      <p><strong>NumÃ©ro du PV :</strong> {{ pvInfo.pv_number || 'Non spÃ©cifiÃ©' }}</p>
      <p><strong>Date :</strong> {{ pvInfo.pv_date || (pvInfo.created_at | date:'medium') }}</p>
      <p><strong>Lieu :</strong> {{ pvInfo.pv_lieu || 'Non spÃ©cifiÃ©' }}</p>
      <p><strong>RÃ©dacteur :</strong> {{ pvInfo.pv_redacteur || 'Non spÃ©cifiÃ©' }}</p>
      <p><strong>Statut :</strong> {{ pvInfo.pv_status || 'Non spÃ©cifiÃ©' }}</p>
    </div>
    <div *ngIf="!pvInfo">
      <p>Aucune information gÃ©nÃ©rale disponible. Veuillez sÃ©lectionner un PV dans la liste ci-dessous.</p>
    </div>
  </section>

  <section class="infos">
  <h2>ğŸ‘¥ Participants</h2>
  <div *ngIf="pvInfo && pvInfo.pv_participants?.length > 0">
    <ul>
      <li *ngFor="let participant of pvInfo.pv_participants">{{ participant.nom }}</li>
    </ul>
  </div>
  <div *ngIf="pvInfo && (!pvInfo.pv_participants || pvInfo.pv_participants.length === 0)">
    <p>Aucun participant n'a Ã©tÃ© enregistrÃ©.</p>
  </div>
  <div *ngIf="!pvInfo">
    <p>Veuillez sÃ©lectionner un PV pour voir les participants.</p>
  </div>
</section>

 

  <section class="infos pv-list">
    <h2>ğŸ“‹ Autres ProcÃ¨s-Verbaux AssociÃ©s</h2>
    <div *ngIf="pvDocuments.length > 0">
      <table>
        <thead>
          <tr>
            <th>Nom du document</th>
            <th>Date de crÃ©ation</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let doc of pvDocuments">
            <td>{{ doc.file_name }}</td>
            <td>{{ doc.created_at | date:'short' }}</td>
            <td class="action-buttons">
              <!-- Le bouton "Voir contenu" affiche le document dans la page. -->
              <button class="btn-action" (click)="viewDocumentAndDetails(doc); $event.stopPropagation()">ğŸ‘ï¸ Voir contenu PV</button>
              <!-- Le bouton "TÃ©lÃ©charger" garde sa fonctionnalitÃ© de tÃ©lÃ©chargement. -->
              <button class="btn-action" (click)="telechargerDocument(doc); $event.stopPropagation()">ğŸ“¥ TÃ©lÃ©charger</button>
              <!-- Le bouton "Signer" ne navigue plus et prÃ©pare le document pour la signature. -->
              <button class="btn-action sign-btn" (click)="signDocument(doc)">âœï¸ Signer</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="pvDocuments.length === 0">
      <p>Aucun autre document PV associÃ© n'a Ã©tÃ© trouvÃ©.</p>
    </div>
  </section>

  <section class="infos" *ngIf="previewUrl">
    <h2>ğŸ‘ï¸ PrÃ©visualisation du document</h2>
    <iframe [src]="previewUrl" width="100%" height="500"></iframe>
  </section>
</div>
